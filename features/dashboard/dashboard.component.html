<div class="dashboard-container">

  <mat-toolbar color="primary" class="dashboard-toolbar">
    <div class="toolbar-left">
      <span class="logo">ðŸ“Š IPI Dashboard</span>
    </div>
    
    <div class="toolbar-right">
     
      <button mat-button (click)="openWidgetSelector()" class="widget-selector-btn" matTooltip="Personalizuj dashboard">
        <mat-icon>dashboard_customize</mat-icon>
        <span class="btn-text">Widget-i</span>
      </button>

      <button mat-button [matMenuTriggerFor]="themeMenu" matTooltip="Promijeni temu">
        <mat-icon>palette</mat-icon>
        <span class="btn-text">{{ currentTheme().name }}</span>
      </button>
      <mat-menu #themeMenu="matMenu">
        <button mat-menu-item *ngFor="let theme of availableThemes" 
                (click)="changeTheme(theme.id)">
          <span class="theme-color" [style.background]="theme.primaryColor"></span>
          {{ theme.name }}
        </button>
      </mat-menu>

      <div *ngIf="user; else loginButton">
        <button mat-button [matMenuTriggerFor]="userMenu" matTooltip="KorisniÄki meni">
          <mat-icon>person</mat-icon>
          <span class="btn-text">{{ getShortUsername() }}</span>  
        </button>
        <mat-menu #userMenu="matMenu">
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            Odjavi se
          </button>
        </mat-menu>
      </div>
      
      <ng-template #loginButton>
        <button mat-button (click)="goToLogin()" matTooltip="Prijavi se">
          <mat-icon>login</mat-icon>
          <span class="btn-text">Prijavi se</span>
        </button>
      </ng-template>
    </div>
  </mat-toolbar>

  <main class="dashboard-content" style="overflow-y: auto; height: calc(100vh - 64px);">
    <div class="welcome-section">
      <h1>ðŸ‘‹ DobrodoÅ¡ao, {{ getUsername() }}!</h1>
      <p>Ovo je tvoj Personal Life Dashboard. Upravljaj widget-ima koje Å¾eliÅ¡ vidjeti.</p>
      
      <div class="dashboard-actions">
        <button mat-raised-button color="primary" (click)="openWidgetSelector()">
          <mat-icon>dashboard_customize</mat-icon>
          Personalizuj Dashboard
        </button>
        
        <div class="widget-stats">
          <span class="stat-item">
            <mat-icon>widgets</mat-icon>
            {{ activeWidgets().length }} aktivnih widget-a
          </span>
        </div>
      </div>
    </div>

    <div class="drag-hint" *ngIf="getDisplayWidgets().length > 1">
      <mat-icon>touch_app</mat-icon>
      <span>Povucite widgete za ikonu u gornjem desnom uglu da ih preuredite</span>
    </div>

    <div class="widget-grid-container">

      <div class="widget-grid" 
           cdkDropList
           (cdkDropListDropped)="onWidgetDrop($event)"
           [cdkDropListData]="getDisplayWidgets()">
        
        <div *ngFor="let widget of getDisplayWidgets()" 
             class="widget-item"
             [class]="getWidgetSizeClass(widget.size)"
             cdkDrag
             [id]="'widget-' + widget.id"
             (click)="navigateToWidgetDetails(widget.id, $event)">

          <div class="drag-handle" cdkDragHandle>
            <mat-icon>drag_indicator</mat-icon>
          </div>

          <div *ngIf="widget.id === 'habit-tracker'">
            <app-habit-tracker></app-habit-tracker>
          </div>

          <div *ngIf="widget.id === 'sleep-tracker'">
            <app-sleep-tracker></app-sleep-tracker>
          </div>

          <div *ngIf="widget.id === 'student-funzone'">
            <app-student-fun-zone></app-student-fun-zone>
          </div>

          <div *ngIf="!['habit-tracker', 'sleep-tracker', 'student-funzone'].includes(widget.id)" 
               class="widget-placeholder">
            <mat-card class="placeholder-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>{{ widget.icon }}</mat-icon>
                  {{ widget.title }}
                </mat-card-title>
                <mat-card-subtitle>{{ widget.category }}</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <p>{{ widget.description }}</p>
                <div class="placeholder-info">
                  <mat-chip color="primary">{{ widget.size === 'large' ? 'Veliki' : widget.size === 'medium' ? 'Srednji' : 'Mali' }}</mat-chip>
                  <p class="coming-soon">U pripremi...</p>
                </div>
              </mat-card-content>
              <mat-card-actions>
                <button mat-button color="accent" (click)="$event.stopPropagation()">
                  <mat-icon>info</mat-icon>
                  Detalji
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </div>

      <div *ngIf="!hasActiveWidgets" class="empty-dashboard">
        <div class="empty-content">
          <mat-icon class="empty-icon">dashboard</mat-icon>
          <h3>Tvoj dashboard je prazan</h3>
          <p>Dodaj widget-e koje Å¾eliÅ¡ pratiti kako bi personalizovao svoj dashboard</p>
          <button mat-raised-button color="primary" (click)="openWidgetSelector()">
            <mat-icon>add</mat-icon>
            Dodaj widget-e
          </button>
        </div>
      </div>
    </div>
  </main>
</div>